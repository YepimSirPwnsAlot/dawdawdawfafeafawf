-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- VARIABLES
local murderer = nil
local espLine = nil
local drawing = false

-- GUI CREATION
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MurderFinderGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 220, 0, 130)
MainFrame.Position = UDim2.new(0.01, 0, 0.8, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Parent = ScreenGui

local UIStroke = Instance.new("UIStroke", MainFrame)
UIStroke.Color = Color3.fromRGB(255, 0, 0)
UIStroke.Thickness = 2

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 8)

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 200, 0, 40)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ToggleButton.Text = "Find Murderer"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 16
ToggleButton.Parent = MainFrame

local ToggleUICorner = Instance.new("UICorner", ToggleButton)
ToggleUICorner.CornerRadius = UDim.new(0, 6)

local MurdererLabel = Instance.new("TextLabel")
MurdererLabel.Size = UDim2.new(0, 200, 0, 30)
MurdererLabel.Position = UDim2.new(0, 10, 0, 60)
MurdererLabel.BackgroundTransparency = 1
MurdererLabel.Text = "Murderer: None"
MurdererLabel.TextColor3 = Color3.fromRGB(255, 85, 85)
MurdererLabel.Font = Enum.Font.Gotham
MurdererLabel.TextSize = 14
MurdererLabel.TextXAlignment = Enum.TextXAlignment.Left
MurdererLabel.Parent = MainFrame

-- ESP FUNCTION
local function createESPLine()
    local line = Drawing.new("Line")
    line.Thickness = 2
    line.Color = Color3.fromRGB(255, 0, 0)
    line.Transparency = 1
    return line
end

local function findMurderer()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local backpack = player:FindFirstChild("Backpack")
            local tool = player.Character:FindFirstChildOfClass("Tool") or (backpack and backpack:FindFirstChildOfClass("Tool"))
            if tool and tool.Name ~= "Gun" then
                return player
            end
        end
    end
    return nil
end

-- DRAWING LOOP
RunService.RenderStepped:Connect(function()
    if drawing and murderer and murderer.Character and murderer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = murderer.Character.HumanoidRootPart
        local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
        if onScreen then
            espLine.From = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y)
            espLine.To = Vector2.new(screenPos.X, screenPos.Y)
            espLine.Visible = true
        else
            espLine.Visible = false
        end
    elseif espLine then
        espLine.Visible = false
    end
end)

-- TOGGLE BUTTON FUNCTIONALITY
ToggleButton.MouseButton1Click:Connect(function()
    if drawing then
        drawing = false
        MurdererLabel.Text = "Murderer: None"
        ToggleButton.Text = "Find Murderer"
        if espLine then
            espLine:Remove()
            espLine = nil
        end
    else
        murderer = findMurderer()
        if murderer then
            MurdererLabel.Text = "Murderer: " .. murderer.Name
            ToggleButton.Text = "Stop"
            espLine = createESPLine()
            drawing = true
        else
            MurdererLabel.Text = "Murderer: Not found"
        end
    end
end)
